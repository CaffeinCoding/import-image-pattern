# Phase 6 ì™„ë£Œ ìš”ì•½: ì´ë¯¸ì§€ ì‚½ì… ë° ì—ëŸ¬ ì²˜ë¦¬

**ìƒíƒœ**: âœ… ì™„ë£Œ  
**ì™„ë£Œ ë‚ ì§œ**: 2025ë…„ 1ì›”  
**ì†Œìš” ì‹œê°„**: ì•½ 2~3ì‹œê°„

---

## ğŸ“‹ ê°œìš”

Phase 6ì—ì„œëŠ” ì´ì œê¹Œì§€ ì„¤ì •í•œ ëª¨ë“  ê°’ë“¤ì„ ì‚¬ìš©í•˜ì—¬ **ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì‚½ì…**í•˜ëŠ” ê¸°ëŠ¥ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ì„±ê³¼

1. âœ… **ì´ë¯¸ì§€ ì‚½ì… ë¡œì§** - Backend êµ¬í˜„ ì™„ë£Œ
2. âœ… **Frontend í†µí•©** - ì™„ë£Œ ë²„íŠ¼ì— ì‚½ì… ê¸°ëŠ¥ ì—°ê²°
3. âœ… **ì—ëŸ¬ ì²˜ë¦¬** - 5ê°€ì§€ ì—ëŸ¬ ì¼€ì´ìŠ¤ ë¶„ë¥˜ ë° ì²˜ë¦¬
4. âœ… **Undo/Cancel** - ì‘ì—… ì·¨ì†Œ ê¸°ëŠ¥ êµ¬í˜„
5. âœ… **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤** - TC-51 ~ TC-58 (8ê°œ) ì‘ì„±

---

## ğŸ¯ êµ¬í˜„ëœ ê¸°ëŠ¥

### 1. insertImages() í•¨ìˆ˜ (Backend)

#### ìœ„ì¹˜

```
src/Code.gs (250ì¤„ ~ 310ì¤„)
```

#### ê¸°ëŠ¥

```javascript
âœ… ì´ë¯¸ì§€ ë°°ì—´ ë°˜ë³µ ì²˜ë¦¬
âœ… ê° ì´ë¯¸ì§€ ê°œë³„ ì—ëŸ¬ ì²˜ë¦¬ (try-catch)
âœ… ì§„í–‰ ìƒí™© ë¡œê¹… (Logger.log)
âœ… ê²°ê³¼ ê°ì²´ ë°˜í™˜ (completed, failed, total)
```

#### ë°˜í™˜ê°’

```javascript
{
  success: boolean,        // ìµœì†Œ 1ê°œ ì´ìƒ ì‚½ì… ì„±ê³µ
  completed: number,       // ì‚½ì… ì„±ê³µ ê°œìˆ˜
  failed: number,         // ì‚½ì… ì‹¤íŒ¨ ê°œìˆ˜
  total: number,          // ì´ ì´ë¯¸ì§€ ê°œìˆ˜
  results: Array          // ê°œë³„ ê²°ê³¼ ë°°ì—´
}
```

---

### 2. insertImageAtCell() í•¨ìˆ˜ (Backend)

#### ê¸°ëŠ¥

```javascript
âœ… Data URL ê²€ì¦
âœ… Base64 ì¶”ì¶œ (imageUrl.split(",")[1])
âœ… Blob ë³€í™˜ (Utilities.newBlob â†’ base64Decode)
âœ… sheet.insertImage() í˜¸ì¶œ
âœ… í¬ê¸° ì„¤ì • (setWidth, setHeight)
âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…
```

#### ì…€ í¬ê¸° ê³„ì‚°

```javascript
const CELL_WIDTH_PX = 88; // ê°€ë¡œ 1ì…€ = 88px
const CELL_HEIGHT_PX = 21; // ì„¸ë¡œ 1ì…€ = 21px

// ì˜ˆ: 2x3 ì…€ = 176px x 63px
const widthPx = width * CELL_WIDTH_PX; // 2 * 88 = 176px
const heightPx = height * CELL_HEIGHT_PX; // 3 * 21 = 63px
```

---

### 3. handleCompleteClick() í•¨ìˆ˜ (Frontend)

#### í”Œë¡œìš°

```
ê²€ì¦ â†’ í™•ì¸ â†’ Progress í‘œì‹œ â†’ Backend í˜¸ì¶œ â†’ ê²°ê³¼ ì²˜ë¦¬
```

#### êµ¬í˜„ ìƒì„¸

```javascript
âœ… validateLayoutAndImages() - ë°°ì¹˜ ê²€ì¦
âœ… selectedCell í™•ì¸
âœ… images.length í™•ì¸
âœ… showProgress() - ì§„í–‰ë¥  í‘œì‹œ
âœ… google.script.run.insertImages() - Backend í˜¸ì¶œ
âœ… withSuccessHandler - ì„±ê³µ ì²˜ë¦¬
âœ… withFailureHandler - ì˜¤ë¥˜ ì²˜ë¦¬
âœ… hideProgress() - ì§„í–‰ë¥  ìˆ¨ê¹€
```

#### ì„±ê³µ ë©”ì‹œì§€ ì˜ˆì‹œ

```
âœ… ì´ë¯¸ì§€ ì‚½ì… ì™„ë£Œ!
ì‚½ì…ë¨: 4ê°œ
ì‹¤íŒ¨: 0ê°œ
```

---

### 4. handleCancelClick() í•¨ìˆ˜ (Frontend)

#### ê¸°ëŠ¥

```javascript
âœ… ì§„í–‰ ì¤‘ ì·¨ì†Œ í™•ì¸ (confirm ëŒ€í™”ìƒì)
âœ… google.script.run.undoLastAction() í˜¸ì¶œ
âœ… ìƒíƒœ ì´ˆê¸°í™” (isProcessing = false)
âœ… UI ì´ˆê¸°í™” (hideProgress, updateCompleteButtonState)
```

#### ì‚¬ìš©ì ê²½í—˜

```
1. "ì·¨ì†Œ" ë²„íŠ¼ í´ë¦­
2. "ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" í™•ì¸
3. í™•ì¸ ì‹œ â†’ Undo í˜¸ì¶œ â†’ ìƒíƒœ ì´ˆê¸°í™”
4. ì·¨ì†Œ ì‹œ â†’ ì‘ì—… ê³„ì† ì§„í–‰
```

---

### 5. ì—ëŸ¬ ì²˜ë¦¬ (handleImageInsertionError)

#### ì—ëŸ¬ ì¼€ì´ìŠ¤ ë¶„ë¥˜

| ì—ëŸ¬ ìœ í˜•      | ì¡°ê±´                           | ë©”ì‹œì§€                             |
| -------------- | ------------------------------ | ---------------------------------- |
| Permission     | "Permission" í¬í•¨              | ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤  |
| Range Error    | "out of bounds" í¬í•¨           | ì…€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤             |
| Data Corrupted | "ì´ë¯¸ì§€ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤" | ì´ë¯¸ì§€ ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤     |
| Invalid Format | "ì˜ëª»ëœ ì´ë¯¸ì§€ í˜•ì‹"           | ì§€ì›í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ í˜•ì‹ì…ë‹ˆë‹¤    |
| Unknown Error  | ê¸°íƒ€                           | ì´ë¯¸ì§€ ì‚½ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ |

#### êµ¬í˜„

```javascript
function handleImageInsertionError(error) {
  const errorStr = error.toString ? error.toString() : String(error);

  if (errorStr.includes("Permission")) {
    return "ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤";
  } else if (errorStr.includes("out of bounds")) {
    return "ì…€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤";
  }
  // ... ê¸°íƒ€ ì¼€ì´ìŠ¤ ...

  return "ì´ë¯¸ì§€ ì‚½ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + errorStr;
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (Phase 6)

### ê¸°ë³¸ í…ŒìŠ¤íŠ¸

| TC    | í•­ëª©                             | ìš°ì„ ìˆœìœ„ |
| ----- | -------------------------------- | -------- |
| TC-51 | ê¸°ë³¸ ì´ë¯¸ì§€ ì‚½ì… (1ê°œ)           | ğŸ”´ ë†’ìŒ  |
| TC-52 | ì—¬ëŸ¬ ì´ë¯¸ì§€ ì‚½ì… (2x2 íŒ¨í„´, 4ê°œ) | ğŸ”´ ë†’ìŒ  |
| TC-53 | ê°„ê²© í¬í•¨ ì´ë¯¸ì§€ ì‚½ì…            | ğŸŸ¡ ì¤‘ê°„  |
| TC-54 | ë¹„í™œì„± ì…€ í¬í•¨ ì‚½ì…              | ğŸŸ¡ ì¤‘ê°„  |
| TC-55 | ë‹¤ì–‘í•œ í¬ê¸° ì´ë¯¸ì§€ ì‚½ì…          | ğŸŸ¡ ì¤‘ê°„  |
| TC-56 | ì‘ì—… ì·¨ì†Œ ê¸°ëŠ¥                   | ğŸŸ¡ ì¤‘ê°„  |
| TC-57 | ì—ëŸ¬ ì²˜ë¦¬: ë²”ìœ„ ë²—ì–´ë‚¨           | ğŸŸ¢ ë‚®ìŒ  |
| TC-58 | ì—ëŸ¬ ì²˜ë¦¬: ì´ë¯¸ì§€ ë°ì´í„° ì†ìƒ    | ğŸŸ¢ ë‚®ìŒ  |

---

## ğŸ“Š ì½”ë“œ ë³€ê²½ í†µê³„

| í•­ëª©                     | ë³€ê²½ì‚¬í•­                                          | ë¼ì¸ ìˆ˜ |
| ------------------------ | ------------------------------------------------- | ------- |
| ìƒˆ í•¨ìˆ˜ (Code.gs)        | insertImages, insertImageAtCell                   | +130    |
| ìˆ˜ì • í•¨ìˆ˜ (sidebar.html) | handleCompleteClick, handleCancelClick            | +85     |
| ì—ëŸ¬ ì²˜ë¦¬ (sidebar.html) | handleImageInsertionError ì¶”ê°€                    | +30     |
| í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤            | TC-51 ~ TC-58 ì¶”ê°€                                | +200    |
| ë¬¸ì„œ                     | DEVELOPMENT_STATUS, README, PHASE6_GUIDE ì—…ë°ì´íŠ¸ | +50     |

**ì´ ì½”ë“œ ì¶”ê°€**: ~200ì¤„  
**ì´ ë¬¸ì„œ ì¶”ê°€**: ~500ì¤„

---

## ğŸ” ì£¼ìš” ê°œì„  ì‚¬í•­

### 1. ì‚¬ìš©ì ê²½í—˜

- âœ… ì§„í–‰ë¥  ë°”ë¡œ ì‹¤ì‹œê°„ í”¼ë“œë°± ì œê³µ
- âœ… ì§ê´€ì ì¸ ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€
- âœ… ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ì„¤ëª…
- âœ… ì‘ì—… ì·¨ì†Œ ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤ìˆ˜ ë³µêµ¬ ê°€ëŠ¥

### 2. ì‹ ë¢°ì„±

- âœ… ê°œë³„ ì´ë¯¸ì§€ ì—ëŸ¬ ì²˜ë¦¬ (1ê°œ ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ëŠ” ê³„ì†)
- âœ… 5ê°€ì§€ ì—ëŸ¬ ì¼€ì´ìŠ¤ ë¶„ë¥˜ ë° ì²˜ë¦¬
- âœ… ìƒì„¸í•œ ì½˜ì†” ë¡œê¹…
- âœ… Base64 ê²€ì¦ ë° Blob ë³€í™˜ ì˜¤ë¥˜ ì²˜ë¦¬

### 3. ê¸°ìˆ 

- âœ… Utilities.newBlob() + base64Decodeë¡œ ì•ˆì „í•œ ì´ë¯¸ì§€ ë³€í™˜
- âœ… sheet.insertImage() API í™œìš©
- âœ… ì…€ ë‹¨ìœ„ í¬ê¸° ê³„ì‚° (88x21px í‘œì¤€)
- âœ… Logger.logë¡œ ë””ë²„ê¹… ìš©ì´

---

## ğŸ“ êµ¬í˜„ íŒ¨í„´

### Backend-Frontend í†µì‹ 

```javascript
// Frontend (handleCompleteClick)
google.script.run
  .withSuccessHandler(function (result) {
    if (result.success) {
      setProgress(100);
      alert(`âœ… ì´ë¯¸ì§€ ì‚½ì… ì™„ë£Œ!\nì‚½ì…ë¨: ${result.completed}ê°œ`);
    } else {
      setProgressError(result.error);
    }
  })
  .withFailureHandler(function (error) {
    console.error("âŒ ì˜¤ë¥˜:", error);
  })
  .insertImages(images, selectedCell, settings, positions);
```

### ê°œë³„ ì´ë¯¸ì§€ ì—ëŸ¬ ì²˜ë¦¬

```javascript
// Backend (insertImages)
for (let i = 0; i < images.length; i++) {
  try {
    // ì´ë¯¸ì§€ ì‚½ì…
    insertImageAtCell(...);
    results.push({ success: true, ... });
  } catch (e) {
    results.push({ success: false, error: e.toString() });
    // ë‹¤ë¥¸ ì´ë¯¸ì§€ëŠ” ê³„ì† ì²˜ë¦¬
  }
}
```

---

## ğŸ“š ë¬¸ì„œ í˜„í™©

### ìƒì„±ëœ ë¬¸ì„œ

- âœ… **PHASE6_SUMMARY.md** - Phase 6 ì™„ë£Œ ìš”ì•½

### ìˆ˜ì •ëœ ë¬¸ì„œ

- âœ… **README.md** - ì§„í–‰ë„ 60% ë°˜ì˜
- âœ… **DEVELOPMENT_STATUS.md** - Phase 6 ì™„ë£Œ ìƒíƒœ
- âœ… **PHASE6_GUIDE.md** - ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
- âœ… **í…ŒìŠ¤íŠ¸ê³„íš.md** - TC-51 ~ TC-58 ì¶”ê°€

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (Phase 7)

### Phase 7: UI/UX ê°œì„  ë° ìµœì í™”

**ì˜ˆìƒ ì‘ì—…**:

1. ì´ë¯¸ì§€ ì„ íƒ UI ê°œì„  (ì¸ë„¤ì¼, ë“œë˜ê·¸ì•¤ë“œë¡­ ë“±)
2. ì„¤ì •ê°’ í”„ë¦¬ì…‹ (ì €ì¥ëœ ë°°ì¹˜ íŒ¨í„´)
3. ë‹¨ì¶•í‚¤ ì§€ì›
4. ë°˜ì‘í˜• ë””ìì¸ ê°œì„ 
5. ì–´ë‘ìš´ í…Œë§ˆ ì§€ì›

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2~3ì¼

---

## ğŸ“Œ ì£¼ìš” í•™ìŠµ í¬ì¸íŠ¸

1. **Google Apps Script API í™œìš©**

   - sheet.insertImage() í•¨ìˆ˜ ì‚¬ìš©ë²•
   - Utilities.newBlob() + base64Decode ì¡°í•©

2. **ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´**

   - ê°œë³„ í•­ëª©ë³„ try-catchë¡œ ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš©
   - ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

3. **ìƒíƒœ ê´€ë¦¬**

   - isProcessing í”Œë˜ê·¸ë¡œ ë™ì‹œ ì‹¤í–‰ ë°©ì§€
   - UI ìƒíƒœì™€ ë°ì´í„° ìƒíƒœ ë™ê¸°í™”

4. **ë¡œê¹… ë° ë””ë²„ê¹…**
   - Logger.logë¡œ Backend ì‹¤í–‰ ì¶”ì 
   - console.logë¡œ Frontend ìƒíƒœ ì¶”ì 

---

## âœ… Phase 6 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] insertImages() í•¨ìˆ˜ êµ¬í˜„
- [x] insertImageAtCell() í•¨ìˆ˜ êµ¬í˜„
- [x] Blob ë³€í™˜ ë¡œì§
- [x] Frontend í†µí•© (handleCompleteClick)
- [x] Progress UI ë™ì‘
- [x] ì—ëŸ¬ ì²˜ë¦¬ (handleImageInsertionError)
- [x] Undo/Cancel ê¸°ëŠ¥
- [x] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± (TC-51 ~ TC-58)
- [x] ë¦°íŠ¸ ê²€ì‚¬ í†µê³¼
- [x] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

**Phase 6 ì™„ë£Œ!** ğŸ‰  
**ì „ì²´ ì§„í–‰ë„**: 60% (6/10 Phase)

ë‹¤ìŒ Phaseë¡œ ì§„í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸš€
